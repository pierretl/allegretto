{% extends 'template/page.twig' %}

{% import 'macro.twig' as macro %}

{% block title %}Administration{% endblock %}

{% block content %}

{# affiche un json en mode debug lisible

    {% if utilisateurs is defined %}
        <pre>{{ utilisateurs|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre>
    {% endif %}
#}
    

    <h2>Ajouter un utilisateurs</h2>

    <form action="action/utilisateur-ajout.php" method="post">


        {% if get.erreur1 %}
            {% set erreurPrenom = 'Le champ est vide' %}
        {% endif %}

        {% if get.erreur2 %}
            {% set erreurMail = 'Le champ est vide' %}
        {% endif %}

        {% if get.erreur3 %}
            {% set erreurMotDePasse = 'Le champ est vide' %}
        {% endif %}


        {{ macro.input('prenom', 'Prénom', get.prenom, erreurPrenom ) }}

        {{ macro.input('mail', 'Adresse mail', get.mail, erreurMail) }}

        {{ macro.input('motdepasse', 'Mot de passe', get.motdepasse, erreurMotDePasse) }}


        <button type="submit">Ajouter</button>


    </form>

    <h2>Liste exhaustive ({{ utilisateurs|length}})</h2>

    <div class="scroll">
        <table border="1" cellpadding="5" cellspacing="1">
            <caption>Liste des utilisateurs</caption>
            <thead>
                <tr>
                    <td>#</td>
                    <td>Prénom</td>
                    <td>Famille</td>
                    <td>Mail</td>
                    <td>Supprimer</td>
                </tr>
            </thead>
            <tbody>
                {% for item in utilisateurs %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ item.prenom }}</td>
                        <td>{{ item.famille }}</td>
                        <td>{{ decrypt(item.mail) }}</td>
                        <td class="text-center">
                            {% if item.groupe != 'admin' %}
                                <form action="action/utilisateur-suppression.php?key={{ loop.index }}" method="post">
                                    <button type="submit" class="btn-s">Supprimer</button>
                                </form>
                            {% else %}
                                [{{ item.groupe }}]
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}